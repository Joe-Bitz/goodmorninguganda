<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Totally Legit Capital™ | Parody Terminal</title>
  <style>
/* CLI tweaks */
#cliLog::-webkit-scrollbar{height:10px;width:10px}
#cliLog::-webkit-scrollbar-thumb{background:rgba(231,236,255,.12);border-radius:999px}
#cliLog .ok{color:#BFF7E3}
#cliLog .warn{color:#FFE9A8}
#cliLog .err{color:#FFD0D9}
#cliLog .cmd{color:rgba(110,231,255,.9)}
#cliLog .dim{opacity:.8}

    :root{
      --bg:#060812;
      --panel:#0C1226;
      --panel2:#0A1021;
      --text:#EAF0FF;
      --muted:#A7B0D8;
      --accent:#6EE7FF;
      --accent2:#A78BFA;
      --good:#34D399;
      --warn:#FBBF24;
      --bad:#FB7185;
      --border:rgba(231,236,255,.08);
      --shadow:0 14px 40px rgba(0,0,0,.35);
      --radius:18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background:
        radial-gradient(1000px 600px at 15% 0%, rgba(167,139,250,.18), transparent 55%),
        radial-gradient(900px 600px at 85% 10%, rgba(110,231,255,.18), transparent 55%),
        linear-gradient(180deg,#040613,#060812 45%,#040613);
      min-height:100vh;
    }
    a{color:var(--accent); text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1240px;margin:0 auto;padding:18px 18px 40px}

    /* Topbar */
    .topbar{
      display:flex; gap:12px; align-items:center; justify-content:space-between;
      padding:14px 16px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      background:rgba(12,18,38,.85);
      box-shadow:var(--shadow);
      backdrop-filter: blur(10px);
      position:sticky; top:14px; z-index:30;
    }
    .brand{display:flex; gap:12px; align-items:center}
    .logo{
      width:42px;height:42px;border-radius:14px;
      background:conic-gradient(from 220deg,var(--accent),var(--accent2),var(--accent));
      box-shadow: 0 0 0 2px rgba(231,236,255,.08), 0 12px 25px rgba(110,231,255,.10);
    }
    .brand h1{margin:0; font-size:13px; text-transform:uppercase; letter-spacing:.7px;}
    .brand .sub{margin-top:2px; color:var(--muted); font-size:12px; font-family:var(--mono);}
    .right{display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end; align-items:center;}
    .pill{
      padding:8px 12px;border-radius:999px;border:1px solid var(--border);
      background:rgba(6,8,18,.4);font-size:12px;white-space:nowrap;
      box-shadow: 0 10px 22px rgba(0,0,0,.18);
      display:inline-flex; align-items:center; gap:8px;
    }
    .parody{
      padding:8px 12px;border-radius:999px;
      border:1px solid rgba(251,191,36,.28);
      background:rgba(251,191,36,.10);
      color:#FFE9A8;font-size:12px;white-space:nowrap;
    }
    .dot{display:inline-block;width:8px;height:8px;border-radius:99px;background:var(--good);box-shadow:0 0 0 3px rgba(52,211,153,.15);vertical-align:middle}

    /* Ticker */
    .ticker{
      margin-top:12px;border:1px solid var(--border);border-radius:14px;overflow:hidden;
      background:rgba(10,16,33,.75);
      box-shadow: 0 12px 30px rgba(0,0,0,.22);
    }
    .marquee{
      display:flex;gap:18px;padding:10px 14px;font-family:var(--mono);font-size:12px;white-space:nowrap;
      animation: scroll 26s linear infinite;
    }
    @keyframes scroll{from{transform:translateX(0)}to{transform:translateX(-50%)}}
    .titem{opacity:.92}
    .pos{color:#BFF7E3}
    .neg{color:#FFD0D9}
    .neu{color:#FFE9A8}

    /* Layout */
    .grid{margin-top:14px;display:grid;grid-template-columns:1.35fr .65fr;gap:14px;}
    .card{
      border:1px solid var(--border);border-radius:var(--radius);
      background:rgba(12,18,38,.82);box-shadow:var(--shadow);
      padding:16px;position:relative;overflow:hidden;
    }
    .card:before{
      content:"";position:absolute;inset:-1px;
      background:
        radial-gradient(520px 220px at 10% 0%, rgba(110,231,255,.14), transparent 60%),
        radial-gradient(520px 220px at 90% 10%, rgba(167,139,250,.12), transparent 62%);
      pointer-events:none;
    }
    .card>*{position:relative}
    .kicker{font-family:var(--mono);color:var(--muted);font-size:12px;text-transform:uppercase;letter-spacing:.5px;}
    .title{margin:10px 0 0;font-size:26px;letter-spacing:-.4px;line-height:1.15;}
    .subtitle{margin:10px 0 0;color:var(--muted);font-size:13px;line-height:1.6;max-width:70ch;}
    .metrics{margin-top:14px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;}
    .metric{border:1px solid var(--border);border-radius:16px;background:rgba(6,8,18,.35);padding:12px;}
    .metric .label{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:12px;}
    .badge{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:rgba(231,236,255,.05);white-space:nowrap;}
    .badge.good{border-color:rgba(52,211,153,.22);background:rgba(52,211,153,.10);color:#BFF7E3}
    .badge.warn{border-color:rgba(251,191,36,.25);background:rgba(251,191,36,.10);color:#FFE9A8}
    .badge.bad{border-color:rgba(251,113,133,.25);background:rgba(251,113,133,.10);color:#FFD0D9}
    .metric .value{margin-top:8px;font-family:var(--mono);font-size:18px;}

    .actions{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;align-items:center;}
    .btn{
      border:1px solid var(--border);background:rgba(231,236,255,.06);color:var(--text);
      padding:10px 12px;border-radius:14px;font-size:13px;cursor:pointer;
      display:inline-flex;gap:10px;align-items:center;
    }
    .btn.primary{background:linear-gradient(90deg,rgba(110,231,255,.16),rgba(167,139,250,.18));border-color:rgba(110,231,255,.22);}
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:translateY(1px)}

    .chartWrap{margin-top:14px;border:1px solid var(--border);border-radius:16px;background:rgba(6,8,18,.35);overflow:hidden;position:relative;}
    .chartHeader{
      display:flex;justify-content:space-between;align-items:center;gap:12px;
      padding:10px 12px;border-bottom:1px solid rgba(231,236,255,.06);
      font-family:var(--mono);font-size:12px;color:var(--muted);
    }
    .chartHeader strong{color:var(--text);font-weight:600}
    canvas{display:block;width:100%;height:240px}
    .haltStamp{
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) rotate(-8deg);
      z-index:4;font-family:var(--mono);font-size:26px;letter-spacing:2px;
      padding:10px 16px;border:2px solid rgba(255,84,84,.55);color:#FFC3C3;
      background:rgba(46,8,8,.72);border-radius:8px;opacity:0;pointer-events:none;
    }
    .haltStamp.show{opacity:1}

    .sideBlock{display:grid;gap:12px;}
    .panelTitle{margin:8px 0 0;font-size:14px;letter-spacing:.6px;text-transform:uppercase;color:var(--muted);}
    .list{margin-top:10px;display:grid;gap:10px;font-size:13px;}
    .item{padding:12px;border-radius:16px;border:1px solid var(--border);background:rgba(6,8,18,.35);}
    .item .top{display:flex;justify-content:space-between;gap:12px;font-family:var(--mono);font-size:12px;color:var(--muted);}
    .item .main{margin-top:6px;line-height:1.5;}
    .mono{font-family:var(--mono)}

    footer{
      margin-top:14px;border-radius:var(--radius);
      border:1px solid rgba(251,191,36,.26);
      background:rgba(251,191,36,.10);
      color:#FFE9A8;padding:14px 16px;font-size:12px;line-height:1.55;
      box-shadow:var(--shadow);
    }

    /* Modals / overlays */
    .overlay{
      position:fixed; inset:0;
      background:rgba(0,0,0,.62);
      display:none; align-items:center; justify-content:center;
      padding:16px;
      z-index:100;
    }
    .overlay.show{display:flex}
    .modal{
      width:min(820px, 100%);
      border-radius:22px;
      border:1px solid rgba(231,236,255,.10);
      background:rgba(12,18,38,.92);
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .modalHeader{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      padding:12px 14px;
      border-bottom:1px solid rgba(231,236,255,.08);
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
    }
    .modalBody{padding:14px}
    .xbtn{
      border:1px solid rgba(231,236,255,.10);
      background:rgba(231,236,255,.06);
      color:var(--text);
      border-radius:12px;
      padding:8px 10px;
      cursor:pointer;
      font-family:var(--mono);
      font-size:12px;
    }

    /* Inputs */
    .field{display:grid;gap:6px}
    label{font-size:12px;color:var(--muted);font-family:var(--mono)}
    input, select{
      width:100%;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(231,236,255,.10);
      background:rgba(6,8,18,.35);
      color:var(--text);
      font-family:var(--mono);
      outline:none;
    }
    input:focus, select:focus{border-color:rgba(110,231,255,.35)}

    /* Ticket */
    .ticketGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center;}
    .hint{color:var(--muted);font-size:12px;line-height:1.5;}
    .riskBox{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(251,191,36,.18);
      background:rgba(251,191,36,.08);
      color:#FFE9A8;
      font-size:12px;
      line-height:1.55;
    }
    .badgeRow{margin-top:10px;display:flex;flex-wrap:wrap;gap:8px}
    .award{
      display:inline-block;padding:4px 9px;border-radius:999px;
      font-size:11px;font-family:var(--mono);white-space:nowrap;
      border:1px solid rgba(255,160,120,.35);background:rgba(255,120,62,.14);color:#FFD8C2;
    }

    /* Toasts */
    .toasts{
      position:fixed;
      right:14px;
      bottom:14px;
      display:grid;
      gap:10px;
      z-index:200;
      width:min(420px, calc(100vw - 28px));
    }
    .toast{
      border-radius:18px;
      border:1px solid rgba(231,236,255,.10);
      background:rgba(12,18,38,.92);
      box-shadow: 0 22px 60px rgba(0,0,0,.45);
      padding:12px 12px;
      overflow:hidden;
    }
    .toastTop{
      display:flex; justify-content:space-between; align-items:center; gap:10px;
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
    }
    .toastMain{margin-top:6px; font-size:13px; line-height:1.45;}
    .toastTag{
      display:inline-block;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(110,231,255,.22);
      background:rgba(110,231,255,.10);
      color:#CFF7FF;
      font-size:11px;
      font-family:var(--mono);
      white-space:nowrap;
    }

    /* Help */
    .keys{display:grid;gap:10px;}
    .keyRow{
      display:flex; justify-content:space-between; gap:10px;
      padding:10px; border-radius:14px;
      border:1px solid rgba(231,236,255,.08);
      background:rgba(6,8,18,.35);
      font-family:var(--mono); font-size:12px; color:var(--muted);
    }
    .kbd{display:inline-flex;align-items:center;gap:6px;color:var(--text);}
    .kbd span{
      display:inline-block; padding:3px 8px; border-radius:10px;
      border:1px solid rgba(231,236,255,.12);
      background:rgba(231,236,255,.06);
      color:var(--text); font-size:12px;
    }

    /* Login screen */
    .lock{
      position:fixed; inset:0;
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(167,139,250,.22), transparent 60%),
        radial-gradient(900px 520px at 80% 10%, rgba(110,231,255,.22), transparent 60%),
        linear-gradient(180deg,#040613,#060812 45%,#040613);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:999;
    }
    .lockCard{
      width:min(720px, 100%);
      border-radius:26px;
      border:1px solid rgba(231,236,255,.10);
      background:rgba(12,18,38,.92);
      box-shadow: 0 40px 120px rgba(0,0,0,.55);
      overflow:hidden;
    }
    .lockTop{
      padding:16px 16px;
      border-bottom:1px solid rgba(231,236,255,.08);
      display:flex;
      justify-content:space-between;
      gap:12px;
      align-items:center;
      font-family:var(--mono);
      color:var(--muted);
      font-size:12px;
    }
    .lockBody{padding:16px}
    .lockTitle{
      margin:0;
      font-size:22px;
      letter-spacing:-.3px;
      color:var(--text);
      font-family:var(--sans);
    }
    .lockSub{
      margin:8px 0 0;
      color:var(--muted);
      font-size:13px;
      line-height:1.6;
      max-width:75ch;
    }
    .lockGrid{
      margin-top:14px;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      align-items:end;
    }
    .lockNote{
      margin-top:12px;
      padding:12px;
      border-radius:16px;
      border:1px solid rgba(251,191,36,.18);
      background:rgba(251,191,36,.08);
      color:#FFE9A8;
      font-size:12px;
      line-height:1.55;
    }

    /* Crash mode visuals */
    body.crash-mode{
      background:
        radial-gradient(1200px 700px at 50% 110%, rgba(255,110,32,.22), transparent 58%),
        radial-gradient(900px 520px at 10% 0%, rgba(255,62,62,.20), transparent 60%),
        radial-gradient(900px 520px at 85% 10%, rgba(255,160,64,.18), transparent 60%),
        linear-gradient(180deg,#120608,#16090b 45%,#110609);
    }
    body.crash-mode .card{
      border-color:rgba(255,124,84,.24);
    }
    body.crash-mode .parody{
      border-color:rgba(255,124,84,.45);
      background:rgba(255,124,84,.16);
      color:#FFD4C6;
    }
    body.crash-mode .card,
    body.crash-mode .ticker{animation:heatWobble 6.6s ease-in-out infinite}
    .broadcast{
      position:sticky;top:0;z-index:80;padding:10px 12px;text-align:center;
      font-family:var(--mono);font-size:12px;letter-spacing:.6px;color:#FFE7D9;
      background:linear-gradient(90deg,rgba(156,14,14,.95),rgba(228,79,24,.95),rgba(156,14,14,.95));
      border-bottom:1px solid rgba(255,170,142,.45);animation:alarmPulse 1.1s steps(2,end) infinite;
    }
    .fire-overlay{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:6;
      overflow:hidden;
    }
    .fire-glow{
      position:absolute;
      left:-6%;
      right:-6%;
      bottom:-12%;
      height:48%;
      background:
        radial-gradient(55% 100% at 20% 100%, rgba(255,62,62,.35), transparent 65%),
        radial-gradient(55% 100% at 50% 100%, rgba(255,120,52,.35), transparent 65%),
        radial-gradient(55% 100% at 80% 100%, rgba(255,182,78,.30), transparent 65%);
      filter: blur(14px);
      animation: heatPulse 2.4s ease-in-out infinite alternate;
    }
    .flame{
      position:absolute;
      bottom:-14%;
      width:44vmin;
      height:70vmin;
      border-radius:40% 60% 45% 55%;
      background:
        radial-gradient(52% 60% at 50% 78%, rgba(255,230,120,.56), rgba(255,146,68,.30) 55%, rgba(255,58,30,0) 78%);
      filter: blur(8px);
      opacity:.38;
      transform-origin:50% 100%;
      animation: flameRise 2.2s ease-in-out infinite;
    }
    .flame.a{left:-5%; animation-delay:0s}
    .flame.b{left:28%; animation-delay:.6s}
    .flame.c{left:62%; animation-delay:1.2s}
    @keyframes flameRise{
      0%{transform:translateY(16px) scale(1,.96) rotate(-3deg)}
      50%{transform:translateY(-10px) scale(1.05,1.08) rotate(3deg)}
      100%{transform:translateY(8px) scale(.98,1) rotate(-2deg)}
    }
    @keyframes heatPulse{
      from{opacity:.62}
      to{opacity:.95}
    }
    @keyframes heatWobble{
      0%{transform:translateX(0) skewX(0deg)}
      25%{transform:translateX(.8px) skewX(.15deg)}
      50%{transform:translateX(-.8px) skewX(-.15deg)}
      75%{transform:translateX(.5px) skewX(.1deg)}
      100%{transform:translateX(0) skewX(0deg)}
    }
    @keyframes alarmPulse{
      from{filter:saturate(1)}
      to{filter:saturate(1.6) brightness(1.08)}
    }

    @media(max-width:980px){
      .grid{grid-template-columns:1fr}
      .metrics{grid-template-columns:1fr}
      .topbar{position:relative; top:auto}
      canvas{height:220px}
      .ticketGrid{grid-template-columns:1fr}
      .lockGrid{grid-template-columns:1fr}
    }
  </style>
</head>

<body class="{% if app_state.crash_mode %}crash-mode{% endif %}">
  {% if app_state.crash_mode %}
  <div class="fire-overlay" aria-hidden="true">
    <div class="fire-glow"></div>
    <div class="flame a"></div>
    <div class="flame b"></div>
    <div class="flame c"></div>
  </div>
  <div class="broadcast" id="broadcastBanner">
    EMERGENCY BROADCAST: NEW EPISODE CONFIRMED • SHORT THESIS DESTROYED • SEEK EMOTIONAL HEDGE IMMEDIATELY
  </div>
  {% endif %}
  <!-- Fake login screen -->
  <div class="lock" id="lock">
    <div class="lockCard">
      <div class="lockTop">
        <div>TERMINAL ACCESS GATE · <span class="mono">TLC™</span></div>
        <div class="mono">Build: 26.1 · Mode: Parody</div>
      </div>
      <div class="lockBody">
        <h2 class="lockTitle">Welcome to Totally Legit Capital™</h2>
        <p class="lockSub">
          This is a satirical “finance terminal” built to roast a friend’s podcast in a responsible way.
          Nothing here is real. No investing. No brokerage. Just vibes.
        </p>

        <div class="lockGrid">
          <div class="field">
            <label for="loginUser">Username</label>
            <input id="loginUser" value="analyst" />
          </div>
          <div class="field">
            <label for="loginPass">Terminal Password</label>
            <input id="loginPass" placeholder="hint: VIBES" type="password" />
          </div>
        </div>

        <div class="row">
          <button class="btn primary" id="unlock">Unlock Terminal</button>
          <button class="btn" id="unlockGuest">Continue as Guest</button>
        </div>

        <div class="lockNote">
          <strong>Parody note:</strong> This “login” is fake. Use it for the joke. Don’t use this site to mislead anyone.
        </div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Totally Legit Capital™</h1>
          <div class="sub">parody terminal • press <span class="mono">?</span> for shortcuts</div>
        </div>
      </div>
      <div class="right">
        <div class="parody">⚠️ PARODY • NOT REAL FINANCE</div>
        <div class="pill"><span class="dot"></span>LIVE: “Absolutely Up”</div>
        <div class="pill mono" id="marginCallPill">Margin: Stable</div>
        <div class="pill mono" id="clock">--:--:--</div>
        <button class="pill" id="sfxToggle" title="Toggle sound effects">🔇 SFX</button>
      </div>
    </div>

    <div class="ticker" aria-label="ticker tape">
      <div class="marquee" id="marquee"></div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="kicker">Portfolio Overview</div>
        <div class="title">Short Book: “Good Morning Uganda from America”</div>
        <div class="subtitle">
          Satirical dashboard tracking fictional returns from “shorting” a Spotify show.
          Hosted by <strong>Hunter Strawn</strong>, <strong>Logan Tibbits</strong>, and <strong>Michael Strawn</strong> —
          friends who just chit-chat about life, nothing, and whatever comes to mind.
        </div>
        {% if app_state.crash_mode and app_state.latest_release %}
        <div class="riskBox" id="episodeCrashNote">
          <strong>EPISODE DROP DETECTED:</strong> "{{ app_state.latest_release.title }}" on {{ app_state.latest_release.date }}.
          Short thesis invalidated. Portfolio now in controlled demolition mode.
        </div>
        <div class="badgeRow">
          <span class="award">Caught Holding the Bag</span>
          <span class="award">Max Pain Candidate</span>
          <span class="award">Diamond Delusion</span>
          <span class="award">Guidance Ignored</span>
        </div>
        {% endif %}

        <div class="metrics">
          <div class="metric">
            <div class="label">
              <span>Net Worth (Definitely Real)</span>
              <span class="badge good">VERIFIED*</span>
            </div>
            <div class="value" id="netWorth">{{ app_state.metrics.net_worth }}</div>
          </div>
          <div class="metric">
            <div class="label">
              <span>Podcast Short Interest</span>
              <span class="badge warn">LEGALISH</span>
            </div>
            <div class="value" id="shortInterest">{{ app_state.metrics.short_interest }}</div>
          </div>
          <div class="metric">
            <div class="label">
              <span>Daily P&L</span>
              <span class="badge bad">VOLATILE</span>
            </div>
            <div class="value" id="pnl">{{ app_state.metrics.pnl }}</div>
          </div>
        </div>

        <div class="actions">
          <button class="btn primary" id="recalc">↻ Recalculate</button>
          <a class="btn" href="https://open.spotify.com/show/2LtuhlpZRS83QYg7chUEao" target="_blank" rel="noreferrer">
            🎧 Open on Spotify
          </a>
          <a class="btn" href="/sec">📄 SEC Filings</a>
          <a class="btn" href="/research">🧠 Research</a>
          <a class="btn" href="/transcript">☎ Earnings Call</a>
          <button class="btn" id="openTicket">🧾 Order Ticket</button>
          <button class="btn" id="openSearch">⌕ Search</button>
          <button class="btn" id="openHelp">?</button>
          {% if app_state.crash_mode %}
          <button class="btn" id="replayCrash">⏪ Crash Replay</button>
          <button class="btn" id="downloadCert">🪦 Death Certificate</button>
          <button class="btn" id="shareMeltdown">🔗 Share Meltdown</button>
          {% endif %}
        </div>

        <div class="chartWrap">
          <div class="chartHeader">
            <div><strong>PODCST</strong> · 1D · “Price” (fictional)</div>
            <div class="mono" id="chartStat">Vol: 0 • Halted: Yes</div>
          </div>
          <div class="haltStamp" id="haltStamp">TRADING HALTED</div>
          <canvas id="chart" width="1200" height="520"></canvas>
        </div>

        <div class="subtitle" style="margin-top:10px">
          <span class="mono">Hotkeys:</span> <span class="mono">/</span> search · <span class="mono">t</span> ticker · <span class="mono">o</span> order ticket · <span class="mono">n</span> news popup · <span class="mono">?</span> help · <span class="mono">Esc</span> close
        </div>
      </div>

      <div class="sideBlock">
        <div class="card">
          <div class="kicker">Headlines</div>
          <div class="panelTitle">Market News</div>
          <div class="list" id="headlines"></div>
          <div class="row" style="margin-top:10px">
            <button class="btn" id="newsNow">🗞 Trigger Breaking News</button>
            <button class="btn" id="copyDisclaimer">⧉ Copy Disclaimer</button>
          </div>
        </div>

        <div class="card">
          <div class="kicker">Positions</div>
          <div class="panelTitle">Holdings & “Derivatives”</div>
          <div class="list">
            <div class="item">
              <div class="top"><span class="mono">PODCST</span><span class="pos mono">+$8,888,888</span></div>
              <div class="main">Short: Good Morning Uganda from America (fictional instrument)</div>
            </div>
            <div class="item">
              <div class="top"><span class="mono">SILNCE</span><span class="pos mono">+$3,141,592</span></div>
              <div class="main">Long: They stopped recording (the perfect catalyst)</div>
            </div>
            <div class="item">
              <div class="top"><span class="mono">HYPE</span><span class="neg mono">-$12.99</span></div>
              <div class="main">Expense: “Launch Week Energy” beverage</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="kicker">Episode Scoreboard</div>
          <div class="panelTitle">Total Catastrophes: {{ app_state.release_stats.total_catastrophes }}</div>
          <div class="list">
            <div class="item">
              <div class="top"><span class="mono">Avg Damage</span><span class="neg mono">-{{ app_state.release_stats.avg_damage_pct }}%</span></div>
              <div class="main">Average drawdown from release events in your episode log.</div>
            </div>
            <div class="item">
              <div class="top"><span class="mono">Worst Day</span><span class="neg mono">-{{ app_state.release_stats.worst_day_pct }}%</span></div>
              <div class="main">Maximum single-event pain captured so far.</div>
            </div>
            <div class="item">
              <div class="top"><span class="mono">Severity</span><span class="mono">{{ app_state.release_stats.severity }}</span></div>
              <div class="main">Live crash severity model based on release count and damage profile.</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <strong>PARODY DISCLAIMER:</strong> This website is satire for entertainment only. It is not a real brokerage,
      not investment advice, and you cannot “short” a podcast. All numbers and charts are fictional.
      <br><br>
      *“Verified” means I verified I typed the numbers.

<!-- Command Line -->
<div class="card" style="margin-top:14px">
  <div class="kicker">Command Line</div>
  <div class="subtitle" style="max-width:none">
    <span class="mono">Tip:</span> try <span class="mono">help</span>, <span class="mono">open sec</span>, <span class="mono">open research</span>, <span class="mono">news</span>, <span class="mono">order</span>
  </div>

  <div style="margin-top:12px;border:1px solid rgba(231,236,255,.08);border-radius:16px;background:rgba(6,8,18,.35);overflow:hidden">
    <div id="cliLog" style="max-height:220px;overflow:auto;padding:12px;font-family:var(--mono);font-size:12px;line-height:1.6;color:var(--muted)"></div>
    <div style="border-top:1px solid rgba(231,236,255,.08);padding:10px;display:flex;gap:10px;align-items:center">
      <span class="mono" style="color:var(--text)">TLC&gt;</span>
      <input id="cliInput" placeholder="type a command…" style="flex:1" autocomplete="off" />
      <button class="btn" id="cliRun">Run</button>
    </div>
  </div>
</div>

    </footer>
  </div>

  <!-- Toast container -->
  <div class="toasts" id="toasts"></div>

  <!-- Search Modal -->
  <div class="overlay" id="searchOverlay" role="dialog" aria-modal="true" aria-label="Search">
    <div class="modal">
      <div class="modalHeader">
        <div>⌕ SEARCH (parody) · type and press Enter</div>
        <button class="xbtn" data-close="searchOverlay">Esc</button>
      </div>
      <div class="modalBody">
        <div class="field">
          <label for="searchInput">Query</label>
          <input id="searchInput" placeholder="Try: SEC, research, earnings, order ticket, vibes..." />
        </div>
        <div class="riskBox">
          <strong>Reminder:</strong> This is a parody terminal. Search results are fake and just route you around the joke site.
        </div>
        <div class="row">
          <button class="btn primary" id="searchGo">Go</button>
          <a class="btn" href="/sec">SEC Filings</a>
          <a class="btn" href="/research">Research</a>
          <a class="btn" href="/transcript">Earnings Call</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Order Ticket Modal -->
  <div class="overlay" id="ticketOverlay" role="dialog" aria-modal="true" aria-label="Order Ticket">
    <div class="modal">
      <div class="modalHeader">
        <div>🧾 ORDER TICKET · PODCST (fictional)</div>
        <button class="xbtn" data-close="ticketOverlay">Esc</button>
      </div>
      <div class="modalBody">
        <div class="ticketGrid">
          <div class="field">
            <label for="side">Side</label>
            <select id="side">
              <option value="BUY">BUY</option>
              <option value="SELL">SELL</option>
              <option value="SHORT" selected>SHORT</option>
              <option value="COVER">COVER</option>
            </select>
          </div>
          <div class="field">
            <label for="symbol">Symbol</label>
            <input id="symbol" value="PODCST" />
          </div>

          <div class="field">
            <label for="qty">Quantity</label>
            <input id="qty" type="number" min="1" value="10000" />
          </div>

          <div class="field">
            <label for="type">Order Type</label>
            <select id="type">
              <option value="MARKET">MARKET</option>
              <option value="LIMIT" selected>LIMIT</option>
              <option value="STOP">STOP</option>
            </select>
          </div>

          <div class="field">
            <label for="limit">Limit Price</label>
            <input id="limit" type="number" step="0.01" value="99.99" />
          </div>

          <div class="field">
            <label for="tif">Time in Force</label>
            <select id="tif">
              <option value="DAY" selected>DAY</option>
              <option value="GTC">GTC</option>
              <option value="IOC">IOC</option>
            </select>
          </div>
        </div>

        <div class="riskBox">
          <strong>Risk Disclosure (parody):</strong> You cannot short a podcast. This ticket does nothing except produce a funny confirmation toast.
        </div>

        <div class="row">
          <button class="btn primary" id="submitOrder">Submit</button>
          <button class="btn" data-close="ticketOverlay">Cancel</button>
          <div class="hint">Hotkey: press <span class="mono">o</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Help Modal -->
  <div class="overlay" id="helpOverlay" role="dialog" aria-modal="true" aria-label="Help">
    <div class="modal">
      <div class="modalHeader">
        <div>? HELP · keyboard shortcuts</div>
        <button class="xbtn" data-close="helpOverlay">Esc</button>
      </div>
      <div class="modalBody">
        <div class="keys">
          <div class="keyRow"><div>Open Search</div><div class="kbd"><span>/</span></div></div>
          <div class="keyRow"><div>Focus Ticker Tape</div><div class="kbd"><span>t</span></div></div>
          <div class="keyRow"><div>Open Order Ticket</div><div class="kbd"><span>o</span></div></div>
          <div class="keyRow"><div>Trigger Breaking News</div><div class="kbd"><span>n</span></div></div>
          <div class="keyRow"><div>Open Help</div><div class="kbd"><span>?</span></div></div>
          <div class="keyRow"><div>Close Modal</div><div class="kbd"><span>Esc</span></div></div>
          <div class="keyRow"><div>Toggle SFX</div><div class="kbd"><span>s</span></div></div>
        </div>
        <div class="riskBox">
          <strong>Parody warning:</strong> Everything on this site is fictional and for entertainment only.
        </div>
      </div>
    </div>
  </div>

  <script>
    const APP_STATE = {{ app_state | tojson }};
    const CRASH_MODE = !!APP_STATE.crash_mode;
    const LATEST_RELEASE = APP_STATE.latest_release;
    const RELEASES = APP_STATE.releases || [];
    const RELEASE_STATS = APP_STATE.release_stats || {};
    if(CRASH_MODE){
      document.body.classList.add("crash-mode");
    }

    // ---------- Fake Login ----------
    const lock = document.getElementById("lock");
    const loginPass = document.getElementById("loginPass");
    const unlockBtn = document.getElementById("unlock");
    const unlockGuest = document.getElementById("unlockGuest");

    function unlock(mode){
      lock.style.display = "none";
      toast("BOOT", mode === "guest" ? "Guest access granted. Compliance: anxious." : "Access granted. Compliance: extremely concerned.");
      if(CRASH_MODE && LATEST_RELEASE){
        toast("ALERT", `Terminal overheating: “${LATEST_RELEASE.title}” released. Portfolio in freefall.`);
        startMarginCountdown();
      }
    }
    unlockBtn.addEventListener("click", ()=>{
      const pass = (loginPass.value || "").trim().toUpperCase();
      if(pass === "VIBES") unlock("vibes");
      else toast("AUTH", "Access denied. Hint: VIBES.");
    });
    unlockGuest.addEventListener("click", ()=>unlock("guest"));
    loginPass.addEventListener("keydown", (e)=>{ if(e.key==="Enter") unlockBtn.click(); });

    // ---------- Clock ----------
    const clockEl = document.getElementById("clock");
    const marginPill = document.getElementById("marginCallPill");
    function tick(){
      clockEl.textContent = new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit", second:"2-digit"});
    }
    setInterval(tick, 250); tick();

    // ---------- Margin countdown ----------
    let marginSeconds = 59;
    function renderMarginCountdown(){
      if(!marginPill) return;
      if(!CRASH_MODE){
        marginPill.textContent = "Margin: Stable";
        return;
      }
      const mm = String(Math.floor(marginSeconds / 60)).padStart(2, "0");
      const ss = String(marginSeconds % 60).padStart(2, "0");
      marginPill.textContent = `Liquidation in ${mm}:${ss}`;
    }
    function startMarginCountdown(){
      if(!CRASH_MODE) return;
      renderMarginCountdown();
      const iv = setInterval(()=>{
        marginSeconds = Math.max(0, marginSeconds - 1);
        renderMarginCountdown();
        if(marginSeconds === 0){
          clearInterval(iv);
          toast("MARGIN", "Forced liquidation complete. Portfolio moved to afterlife accounting.");
          if(sfxOn){ beep(300,0.12,0.03); setTimeout(()=>beep(240,0.16,0.03), 140); }
        }
      }, 1000);
    }

    // ---------- SFX (simple beeps) ----------
    let sfxOn = false;
    const sfxBtn = document.getElementById("sfxToggle");
    let audioCtx = null;

    function ensureAudio(){
      if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    function beep(freq=740, dur=0.05, gain=0.03){
      if(!sfxOn) return;
      ensureAudio();
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = "square";
      o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      setTimeout(()=>{ o.stop(); }, dur*1000);
    }
    function newsBeep(){
      if(!sfxOn) return;
      beep(880, 0.06, 0.035);
      setTimeout(()=>beep(660, 0.08, 0.03), 80);
      setTimeout(()=>beep(990, 0.08, 0.03), 170);
    }

    function setSfx(on){
      sfxOn = on;
      sfxBtn.textContent = on ? "🔊 SFX" : "🔇 SFX";
      toast("SFX", on ? "Sound effects ON" : "Sound effects OFF");
      if(on) ensureAudio();
    }
    sfxBtn.addEventListener("click", ()=>setSfx(!sfxOn));

    // ---------- Ticker tape ----------
    const tape = CRASH_MODE ? [
      {t:"PODCST", p:"-84.7%", cls:"neg"},
      {t:"SILNCE", p:"-99.9%", cls:"neg"},
      {t:"HYPE", p:"-45.2%", cls:"neg"},
      {t:"MARGIN", p:"CALLING", cls:"neu"},
      {t:"REGUL8", p:"NO MERCY", cls:"neu"},
      {t:"NFA", p:"TOLD YOU SO", cls:"neu"},
      {t:"POD", p:"NEW EP LIVE", cls:"pos"},
    ] : [
      {t:"PODCST", p:"+12.4%", cls:"pos"},
      {t:"SILNCE", p:"+999.0%", cls:"pos"},
      {t:"HYPE", p:"-2.1%", cls:"neg"},
      {t:"VIBES", p:"+0.7%", cls:"pos"},
      {t:"REGUL8", p:"HALTED", cls:"neu"},
      {t:"CRINGE", p:"+4.2%", cls:"pos"},
      {t:"EGO", p:"-0.3%", cls:"neg"},
      {t:"NFA", p:"NOT FIN. ADVICE", cls:"neu"},
      {t:"POD", p:"EPS: N/A", cls:"neu"},
    ];
    function buildMarquee(){
      const parts = tape.map(x => `<span class="titem"><span class="mono">${x.t}</span> <span class="${x.cls} mono">${x.p}</span></span>`);
      document.getElementById("marquee").innerHTML = parts.join(" · ") + " · " + parts.join(" · ");
    }
    buildMarquee();

    // ---------- Headlines ----------
    const headlinePool = [
      ["ALGO","Models confirm: ‘friends talking’ remains illiquid asset class."],
      ["EARN","Earnings call canceled due to ‘we are tired’ (unconfirmed)."],
      ["HALT","PODCST halted pending ‘new episode’ (no ETA)."],
      ["MACRO","Rates unchanged; vibes stronger than fundamentals."],
      ["RISK","Risk team files report titled ‘This Is A Joke, Right?’"],
      ["FLOW","Unusual options activity detected in ‘silence futures’."],
      ["GUID","Company guides ‘maybe next week’ for episode release."],
      ["MKT","Broad market rallies on absolutely nothing."],
    ];
    const headlinesSeed = [
      {time:"08:14", tag:"ALGO", text:"Models confirm: ‘friends talking’ remains illiquid asset class."},
      {time:"09:02", tag:"EARN", text:"Earnings call canceled due to ‘we are tired’ (unconfirmed)."},
      {time:"10:37", tag:"HALT", text:"PODCST halted pending ‘new episode’ (no ETA)."},
      {time:"11:11", tag:"MACRO", text:"Rates unchanged; vibes stronger than fundamentals."},
      {time:"12:28", tag:"RISK", text:"Risk team files report titled ‘This Is A Joke, Right?’"},
    ];
    if(CRASH_MODE && LATEST_RELEASE){
      const crashMsg = `New episode dropped: “${LATEST_RELEASE.title}” (${LATEST_RELEASE.date}). Fake short strategy imploded.`;
      headlinePool.unshift(["DROP", crashMsg]);
      headlinesSeed.unshift({
        time: new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"}),
        tag: "DROP",
        text: crashMsg
      });
    }
    const hl = document.getElementById("headlines");
    function renderHeadlines(){
      hl.innerHTML = headlinesSeed.map(h => `
        <div class="item">
          <div class="top"><span>${h.time} · <span class="mono">${h.tag}</span></span><span class="mono muted">Wire</span></div>
          <div class="main">${h.text}</div>
        </div>
      `).join("");
    }
    renderHeadlines();

    // ---------- Fake numbers ----------
    const netWorthEl = document.getElementById("netWorth");
    const pnlEl = document.getElementById("pnl");
    const shortEl = document.getElementById("shortInterest");
    const statEl = document.getElementById("chartStat");

    function money(x){
      const sign = x < 0 ? "-" : "+";
      const abs = Math.abs(x);
      return `${sign}$${abs.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;
    }

    // ---------- Bloomberg-ish chart ----------
    const canvas = document.getElementById("chart");
    const ctx = canvas.getContext("2d");
    const haltStamp = document.getElementById("haltStamp");
    let halted = false;

    function randn(){
      let u = 0, v = 0;
      while(u === 0) u = Math.random();
      while(v === 0) v = Math.random();
      return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
    }
    function makeSeries(n=180){
      if(CRASH_MODE){
        let price = 102.0;
        const out = [];
        const dropIdx = Math.floor(n * 0.36);
        for(let i=0;i<n;i++){
          if(i === dropIdx){
            price = Math.max(0.6, price * (0.18 + Math.random()*0.10));
          } else {
            const shock = randn()*0.6;
            const drift = -0.14;
            price = Math.max(0.5, price + drift + shock);
          }
          out.push(price);
        }
        return out;
      }

      let price = 102.0;
      let drift = -0.002;
      const out = [];
      for(let i=0;i<n;i++){
        const shock = randn()*0.8;
        const revert = (102 - price)*0.02;
        price = Math.max(12, price + drift + shock + revert);
        out.push(price);
      }
      return out;
    }

    function drawChart(series){
      const w = canvas.width, h = canvas.height;
      ctx.clearRect(0,0,w,h);

      const padL=56, padR=20, padT=20, padB=44;
      const gw = w - padL - padR;
      const gh = h - padT - padB;

      ctx.strokeStyle = "rgba(231,236,255,0.08)";
      ctx.lineWidth = 1;

      const rows = 6, cols = 8;
      for(let r=0;r<=rows;r++){
        const y = padT + (gh/rows)*r;
        ctx.beginPath(); ctx.moveTo(padL,y); ctx.lineTo(padL+gw,y); ctx.stroke();
      }
      for(let c=0;c<=cols;c++){
        const x = padL + (gw/cols)*c;
        ctx.beginPath(); ctx.moveTo(x,padT); ctx.lineTo(x,padT+gh); ctx.stroke();
      }

      const min = Math.min(...series), max = Math.max(...series);
      const yFor = v => padT + (max - v) / (max - min + 1e-9) * gh;

      ctx.fillStyle = "rgba(167,176,216,0.95)";
      ctx.font = "12px " + getComputedStyle(document.documentElement).getPropertyValue('--mono');
      ctx.textAlign = "right";
      ctx.textBaseline = "middle";
      for(let r=0;r<=rows;r++){
        const v = max - (max-min)*(r/rows);
        const y = padT + (gh/rows)*r;
        ctx.fillText(v.toFixed(1), padL-10, y);
      }

      const xStep = gw / (series.length - 1);
      const line = () => {
        ctx.beginPath();
        series.forEach((v,i)=>{
          const x = padL + i*xStep;
          const y = yFor(v);
          if(i===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        });
      };

      ctx.strokeStyle = "rgba(110,231,255,0.14)";
      ctx.lineWidth = 8;
      ctx.lineJoin = "round";
      ctx.lineCap = "round";
      line(); ctx.stroke();

      ctx.strokeStyle = "rgba(110,231,255,0.85)";
      ctx.lineWidth = 2;
      line(); ctx.stroke();

      const grad = ctx.createLinearGradient(0,padT,0,padT+gh);
      grad.addColorStop(0,"rgba(110,231,255,0.12)");
      grad.addColorStop(1,"rgba(167,139,250,0.03)");
      ctx.fillStyle = grad;
      ctx.beginPath();
      series.forEach((v,i)=>{
        const x = padL + i*xStep;
        const y = yFor(v);
        if(i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
      });
      ctx.lineTo(padL+gw, padT+gh);
      ctx.lineTo(padL, padT+gh);
      ctx.closePath();
      ctx.fill();

      const last = series[series.length-1];
      const lx = padL + (series.length-1)*xStep;
      const ly = yFor(last);
      ctx.fillStyle = "rgba(110,231,255,0.95)";
      ctx.beginPath(); ctx.arc(lx, ly, 4, 0, Math.PI*2); ctx.fill();

      ctx.fillStyle = "rgba(167,176,216,0.85)";
      ctx.textAlign = "left";
      ctx.textBaseline = "alphabetic";
      ctx.fillText("Source: vibes • feed: imagination • instrument: PODCST (fictional)", padL, h-16);
    }

    function updateStats(s){
      const last = s[s.length-1];
      const first = s[0];
      const chg = ((last-first)/first)*100;
      const vol = Math.floor(1000 + Math.random()*9000);
      if(CRASH_MODE){
        statEl.textContent = `Vol: ${vol.toLocaleString()} • Chg: ${chg.toFixed(2)}% • Circuit: Broken`;
        return;
      }
      statEl.textContent = `Vol: ${vol.toLocaleString()} • Chg: ${chg.toFixed(2)}% • Halted: Yes`;
    }

    let series = makeSeries();
    drawChart(series);
    updateStats(series);

    function toggleHalt(on){
      halted = !!on;
      if(!haltStamp) return;
      haltStamp.classList.toggle("show", halted);
    }

    function animateReplay(target){
      const frames = Math.max(24, target.length);
      let idx = 8;
      toggleHalt(false);
      const iv = setInterval(()=>{
        idx += 4;
        const partial = target.slice(0, Math.min(target.length, idx));
        drawChart(partial);
        updateStats(partial);
        if(idx >= target.length){
          clearInterval(iv);
          series = target;
          drawChart(series);
          updateStats(series);
          toast("REPLAY", "Crash replay complete.");
        }
      }, 38);
    }

    function startCircuitBreakers(){
      if(!CRASH_MODE) return;
      setInterval(()=>{
        if(document.hidden) return;
        if(Math.random() < 0.45){
          toggleHalt(true);
          toast("HALT", "Circuit breaker triggered.");
          setTimeout(()=>{
            toggleHalt(false);
            if(Math.random() < 0.65){
              series = makeSeries();
              drawChart(series);
              updateStats(series);
            }
          }, 2200 + Math.floor(Math.random()*1700));
        }
      }, 9000);
    }

    function resizeCanvas(){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const wrap = canvas.parentElement.getBoundingClientRect();
      const cssW = Math.floor(wrap.width);
      const cssH = 240;
      canvas.style.width = cssW + "px";
      canvas.style.height = cssH + "px";
      canvas.width = Math.floor(cssW * dpr);
      canvas.height = Math.floor(cssH * dpr);
      ctx.setTransform(dpr,0,0,dpr,0,0);
      drawChart(series);
      updateStats(series);
    }
    window.addEventListener("resize", resizeCanvas);
    setTimeout(resizeCanvas, 50);
    startCircuitBreakers();

    // ---------- Toasts ----------
    const toastWrap = document.getElementById("toasts");
    function toast(tag, msg){
      const el = document.createElement("div");
      el.className = "toast";
      const t = new Date().toLocaleTimeString([], {hour:"2-digit", minute:"2-digit"});
      el.innerHTML = `
        <div class="toastTop">
          <span><span class="toastTag">${tag}</span> · <span class="mono">${t}</span></span>
          <button class="xbtn" style="padding:6px 8px" aria-label="close">x</button>
        </div>
        <div class="toastMain">${msg}</div>
      `;
      el.querySelector("button").addEventListener("click", () => el.remove());
      toastWrap.appendChild(el);
      setTimeout(() => { if(el.isConnected) el.remove(); }, 8500);
    }

    // ---------- Breaking news ----------
    function breakingNews(){
      const pick = headlinePool[Math.floor(Math.random()*headlinePool.length)];
      toast("BREAK", `<strong>${pick[0]}:</strong> ${pick[1]}`);
      newsBeep();
    }
    document.getElementById("newsNow").addEventListener("click", breakingNews);

    // occasional breaking news
    setInterval(() => {
      if(document.hidden) return;
      if(Math.random() < 0.35) breakingNews();
    }, 18000);

    // ---------- Modals ----------
    function openOverlay(id){
      document.getElementById(id).classList.add("show");
      if(id === "searchOverlay") setTimeout(()=>document.getElementById("searchInput").focus(), 50);
    }
    function closeOverlay(id){ document.getElementById(id).classList.remove("show"); }
    document.getElementById("openSearch").addEventListener("click", ()=>openOverlay("searchOverlay"));
    document.getElementById("openTicket").addEventListener("click", ()=>openOverlay("ticketOverlay"));
    document.getElementById("openHelp").addEventListener("click", ()=>openOverlay("helpOverlay"));

    document.querySelectorAll("[data-close]").forEach(b=>{
      b.addEventListener("click", ()=>closeOverlay(b.getAttribute("data-close")));
    });
    document.querySelectorAll(".overlay").forEach(ov=>{
      ov.addEventListener("click", (e)=>{ if(e.target === ov) ov.classList.remove("show"); });
    });

    // ---------- Search routing ----------
    function doSearch(){
      const q = document.getElementById("searchInput").value.trim().toLowerCase();
      if(!q){ toast("SRCH","Type something first."); return; }
      beep(740,0.05,0.02);
      if(q.includes("sec") || q.includes("filing")) { window.location.href = "/sec"; return; }
      if(q.includes("research") || q.includes("analyst")) { window.location.href = "/research"; return; }
      if(q.includes("earn") || q.includes("call") || q.includes("transcript")) { window.location.href = "/transcript"; return; }
      if(q.includes("spotify") || q.includes("podcast")) { window.open("https://open.spotify.com/show/2LtuhlpZRS83QYg7chUEao","_blank"); return; }
      if(q.includes("order") || q.includes("ticket")) { closeOverlay("searchOverlay"); openOverlay("ticketOverlay"); return; }
      toast("SRCH", `No real results for “${q}”. This terminal runs on vibes.`);
    }
    document.getElementById("searchGo").addEventListener("click", doSearch);
    document.getElementById("searchInput").addEventListener("keydown", (e)=>{ if(e.key === "Enter") doSearch(); });

    // ---------- Order ticket ----------
    document.getElementById("submitOrder").addEventListener("click", ()=>{
      const side = document.getElementById("side").value;
      const sym = document.getElementById("symbol").value || "PODCST";
      const qty = Number(document.getElementById("qty").value || 0);
      const type = document.getElementById("type").value;
      const limit = document.getElementById("limit").value;
      const tif = document.getElementById("tif").value;

      closeOverlay("ticketOverlay");
      beep(660,0.06,0.03);

      const px = (type === "LIMIT" || type === "STOP") ? ` @ ${Number(limit).toFixed(2)}` : "";
      toast("ORDER", `${side} ${qty.toLocaleString()} ${sym} ${type}${px} (${tif}) — <em>accepted by imagination exchange</em>.`);
    });

    // ---------- Recalc ----------
    document.getElementById("recalc").addEventListener("click", () => {
      if(CRASH_MODE){
        const net = (20 + Math.random()*5000);
        netWorthEl.textContent = `$${net.toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;
        const pnl = -(2_000_000 + Math.random()*7_000_000);
        pnlEl.textContent = money(pnl);
        const si = (Math.random()*3.5).toFixed(2);
        shortEl.textContent = `${si}%`;
        series = makeSeries();
        drawChart(series);
        updateStats(series);
        toast("MELTDOWN", "New episode repriced the entire fake portfolio to near-zero.");
        beep(440,0.07,0.03);
        return;
      }

      const base = 8_000_000 + Math.random()*10_000_000;
      const cents = Math.random();
      netWorthEl.textContent = `$${(base + cents).toLocaleString(undefined,{minimumFractionDigits:2, maximumFractionDigits:2})}`;
      const pnl = (Math.random()*160000 - 20000);
      pnlEl.textContent = money(pnl);
      const si = (200 + Math.random()*600).toFixed(2);
      shortEl.textContent = `${si}%`;
      series = makeSeries();
      drawChart(series);
      updateStats(series);
      toast("CALC", "Recomputed returns using advanced math (lying).");
      beep(740,0.05,0.02);
    });

    // ---------- Crash extras ----------
    function exportDeathCertificate(){
      const cv = document.createElement("canvas");
      cv.width = 1400; cv.height = 900;
      const gx = cv.getContext("2d");
      const grad = gx.createLinearGradient(0,0,0,cv.height);
      grad.addColorStop(0, "#1A0A0A");
      grad.addColorStop(1, "#05070F");
      gx.fillStyle = grad;
      gx.fillRect(0,0,cv.width,cv.height);

      gx.strokeStyle = "rgba(255,148,120,0.35)";
      gx.lineWidth = 4;
      gx.strokeRect(36,36,cv.width-72,cv.height-72);
      gx.fillStyle = "#FFD8C2";
      gx.font = "700 72px system-ui";
      gx.fillText("PORTFOLIO DEATH CERTIFICATE", 78, 150);
      gx.font = "500 38px ui-monospace, monospace";
      gx.fillText(`Owner: Totally Legit Capital`, 78, 250);
      gx.fillText(`Cause: Episode Release Shock`, 78, 320);
      gx.fillText(`Latest Episode: ${LATEST_RELEASE ? LATEST_RELEASE.title : "N/A"}`, 78, 390);
      gx.fillText(`Date: ${LATEST_RELEASE ? LATEST_RELEASE.date : new Date().toISOString().slice(0,10)}`, 78, 460);
      gx.fillText(`Status: Irreversibly Cooked`, 78, 530);
      gx.fillStyle = "rgba(255,216,194,0.7)";
      gx.font = "400 26px ui-monospace, monospace";
      gx.fillText("PARODY DOCUMENT - NOT REAL FINANCIAL RECORD", 78, 640);

      const url = cv.toDataURL("image/png");
      const a = document.createElement("a");
      a.href = url;
      a.download = "portfolio-death-certificate.png";
      a.click();
      toast("DOC", "Death certificate exported.");
    }

    async function shareMeltdownCard(){
      const text = `TLC MELTDOWN ALERT: "${LATEST_RELEASE ? LATEST_RELEASE.title : "New episode"}" dropped and the fake short book vaporized. #Parody #NotFinancialAdvice`;
      try{
        await navigator.clipboard.writeText(text);
        toast("SHARE", "Meltdown text copied to clipboard.");
      }catch{
        prompt("Copy meltdown text:", text);
      }
      const shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}`;
      window.open(shareUrl, "_blank", "noopener,noreferrer");
    }

    const replayBtn = document.getElementById("replayCrash");
    if(replayBtn){
      replayBtn.addEventListener("click", ()=>{
        const target = makeSeries(180);
        animateReplay(target);
      });
    }
    const certBtn = document.getElementById("downloadCert");
    if(certBtn){ certBtn.addEventListener("click", exportDeathCertificate); }
    const shareBtn = document.getElementById("shareMeltdown");
    if(shareBtn){ shareBtn.addEventListener("click", shareMeltdownCard); }

    // ---------- Copy disclaimer ----------
    document.getElementById("copyDisclaimer").addEventListener("click", async ()=>{
      const text = "PARODY: This site is satire for entertainment only. Not real finance, not advice. Charts/numbers are fictional.";
      try{ await navigator.clipboard.writeText(text); toast("COPY","Disclaimer copied."); beep(820,0.05,0.02); }
      catch{ prompt("Copy this disclaimer:", text); }
    });

    // ---------- Keyboard shortcuts ----------
    document.addEventListener("keydown", (e)=>{
      const tag = (document.activeElement && document.activeElement.tagName) ? document.activeElement.tagName.toLowerCase() : "";
      const typing = tag === "input" || tag === "textarea" || tag === "select";

      if(e.key === "Escape"){
        document.querySelectorAll(".overlay.show").forEach(ov=>ov.classList.remove("show"));
        return;
      }
      if(typing) return;

      const k = e.key.toLowerCase();
      if(k === "/"){
        e.preventDefault(); openOverlay("searchOverlay"); beep(720,0.04,0.02);
      } else if(k === "o"){
        openOverlay("ticketOverlay"); beep(680,0.04,0.02);
      } else if(k === "n"){
        breakingNews();
      } else if(e.key === "?"){
        openOverlay("helpOverlay"); beep(760,0.04,0.02);
      } else if(k === "t"){
        document.querySelector(".ticker").scrollIntoView({behavior:"smooth", block:"center"});
        toast("NAV","Focused ticker tape.");
      } else if(k === "s"){
        setSfx(!sfxOn);
      } else if(k === "r"){
        // bonus: quick refresh
        document.getElementById("recalc").click();
      }
else if(k === "c"){
  document.getElementById("cliInput").focus();
  toast("NAV","Focused CLI.");
}
      if(sfxOn && ["a","s","d","f","j","k","l",";"].includes(k)) beep(640,0.02,0.01);
    });

    // Boot toast after unlock
    setTimeout(()=>{ /* kept empty; lock handles boot */ }, 0);

// ---------- Command Line ----------
  const cliLog = document.getElementById("cliLog");
  const cliInput = document.getElementById("cliInput");
  const cliRun = document.getElementById("cliRun");

  function cliPrint(html){
    const line = document.createElement("div");
    line.innerHTML = html;
    cliLog.appendChild(line);
    cliLog.scrollTop = cliLog.scrollHeight;
  }

  function cliBanner(){
    cliPrint(`<span class="dim">TLC Terminal CLI online.</span>`);
    cliPrint(`<span class="dim">Type <span class="cmd">help</span> for commands.</span>`);
  }

  function cliHelp(){
    cliPrint(`<span class="ok">Commands:</span>`);
    cliPrint(`<span class="cmd">help</span> — show this help`);
    cliPrint(`<span class="cmd">open sec</span> | <span class="cmd">open research</span> | <span class="cmd">open earnings</span> — navigate pages`);
    cliPrint(`<span class="cmd">open spotify</span> — open the podcast`);
    cliPrint(`<span class="cmd">order</span> — open order ticket`);
    cliPrint(`<span class="cmd">search &lt;query&gt;</span> — open search modal + fill query`);
    cliPrint(`<span class="cmd">news</span> — breaking news toast`);
    cliPrint(`<span class="cmd">recalc</span> — recompute fake returns`);
    cliPrint(`<span class="cmd">sfx on</span> | <span class="cmd">sfx off</span> — toggle sound`);
    cliPrint(`<span class="cmd">pray</span> | <span class="cmd">hedge</span> | <span class="cmd">reverse</span> | <span class="cmd">blame market</span> — panic controls`);
    cliPrint(`<span class="cmd">clear</span> — clear CLI log`);
  }

  function runCli(raw){
    const input = (raw || "").trim();
    if(!input) return;

    cliPrint(`<span class="cmd">TLC&gt; ${escapeHtml(input)}</span>`);
    const cmd = input.toLowerCase();

    // helpers from your existing page:
    // - openOverlay(id)
    // - breakingNews()
    // - toast(tag, msg)
    // - setSfx(on)
    // - doSearch() uses #searchInput
    // - recalc button exists

    if(cmd === "help" || cmd === "?"){
      cliHelp(); return;
    }
    if(cmd === "clear"){
      cliLog.innerHTML = "";
      cliPrint(`<span class="dim">cleared.</span>`);
      return;
    }
    if(cmd === "news"){
      breakingNews();
      cliPrint(`<span class="ok">ok:</span> breaking news triggered.`);
      return;
    }
    if(cmd === "order"){
      openOverlay("ticketOverlay");
      cliPrint(`<span class="ok">ok:</span> opened order ticket.`);
      return;
    }
    if(cmd === "recalc"){
      document.getElementById("recalc").click();
      cliPrint(`<span class="ok">ok:</span> recalculated.`);
      return;
    }
    if(cmd.startsWith("sfx ")){
      const val = cmd.split(" ").slice(1).join(" ").trim();
      if(val === "on"){ setSfx(true); cliPrint(`<span class="ok">ok:</span> sfx on.`); return; }
      if(val === "off"){ setSfx(false); cliPrint(`<span class="ok">ok:</span> sfx off.`); return; }
      cliPrint(`<span class="warn">usage:</span> sfx on | sfx off`);
      return;
    }
    if(cmd.startsWith("open ")){
      const target = cmd.replace(/^open\s+/, "").trim();
      if(target === "sec" || target === "filings"){ window.location.href = "/sec"; return; }
      if(target === "research"){ window.location.href = "/research"; return; }
      if(target === "earnings" || target === "transcript" || target === "call"){ window.location.href = "/transcript"; return; }
      if(target === "spotify" || target === "podcast"){
        window.open("https://open.spotify.com/show/2LtuhlpZRS83QYg7chUEao", "_blank");
        cliPrint(`<span class="ok">ok:</span> opened spotify.`);
        return;
      }
      cliPrint(`<span class="err">error:</span> unknown open target: <span class="cmd">${escapeHtml(target)}</span>`);
      return;
    }
    if(cmd.startsWith("search ")){
      const q = input.slice(7).trim();
      openOverlay("searchOverlay");
      setTimeout(()=>{
        const si = document.getElementById("searchInput");
        si.value = q;
        si.focus();
      }, 50);
      cliPrint(`<span class="ok">ok:</span> search ready for “${escapeHtml(q)}”.`);
      return;
    }
    if(cmd === "pray"){
      toast("PRAY", "Prayer submitted. Compliance says this is not a risk framework.");
      cliPrint(`<span class="warn">warning:</span> prayer queue length: 9,421`);
      return;
    }
    if(cmd === "hedge"){
      toast("HEDGE", "Opened hedge in SILNCE futures (still fake).");
      cliPrint(`<span class="ok">ok:</span> hedge filled at terrible price.`);
      return;
    }
    if(cmd === "reverse"){
      toast("REVERSE", "Attempting to reverse from short to long... spread too wide.");
      cliPrint(`<span class="err">error:</span> reverse rejected by imagination exchange.`);
      return;
    }
    if(cmd === "blame market"){
      toast("BLAME", "Statement drafted: macro, rates, and moon phase caused this.");
      cliPrint(`<span class="dim">press release sent to nobody.</span>`);
      return;
    }

    cliPrint(`<span class="err">error:</span> unknown command. try <span class="cmd">help</span>.`);
  }

  function escapeHtml(s){
    return s.replace(/[&<>"']/g, (c)=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  cliRun.addEventListener("click", ()=>{
    runCli(cliInput.value);
    cliInput.value = "";
    cliInput.focus();
  });

  cliInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter"){
      runCli(cliInput.value);
      cliInput.value = "";
    }
  });

  // auto banner once terminal is unlocked
  // if you want it only AFTER login disappears, this still works fine:
  setTimeout(cliBanner, 500);
  </script>
</body>
</html>

